<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../../img/favicon.ico">

    
    <title>(Rank 6) Team Compaction - LevelDB WIKI</title>
    

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/v4-shims.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.min.css">
    <link href='//rsms.me/inter/inter.css' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../../css/base.min.css" rel="stylesheet">
    <link href="../../css/cinder.min.css" rel="stylesheet">

    
        
        <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/styles/github.min.css">
        
    

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

    

     
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            
              <a class="navbar-brand" href="../..">LevelDB WIKI</a>
            
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Code Analysis <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../analysis/memtable/">Memtable</a>
</li>

                        
                            
<li >
    <a href="../../analysis/wal/">WAL</a>
</li>

                        
                            
<li >
    <a href="../../analysis/manifest/">Manifest</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Compaction</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../analysis/compaction/compaction/">Compaction Types</a>
</li>

        
            
<li >
    <a href="../../analysis/compaction/Major-Compaction/">Major Compaction</a>
</li>

        
            
<li >
    <a href="../../analysis/compaction/Minor-Compaction/">Minor Compaction</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">SSTable</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../analysis/sstable/sstable/">SSTable Structure</a>
</li>

        
            
<li >
    <a href="../../analysis/sstable/sstable-write/">SSTable Write</a>
</li>

        
            
<li >
    <a href="../../analysis/sstable/sstable-read/">SSTable Read</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Bloom Filter</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../analysis/bloomfilter/bloomfilter/">Bloom Filter Structure</a>
</li>

        
            
<li >
    <a href="../../analysis/bloomfilter/bloomfilter-write/">Bloom Filter Write</a>
</li>

        
            
<li >
    <a href="../../analysis/bloomfilter/bloomfilter-read/">Bloom Filter Read</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../../analysis/cache/">Cache</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Benchmark Experiment <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">WAL</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../benchmarks/wal_1/">Disable_wal</a>
</li>

        
            
<li >
    <a href="../../benchmarks/wal_2/">Max_total_wal_size</a>
</li>

        
            
<li >
    <a href="../../benchmarks/wal_3/">Manual_wal_flush</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../../benchmarks/compaction/">Compaction</a>
</li>

                        
                            
<li >
    <a href="../../benchmarks/sstable/">SSTable</a>
</li>

                        
                            
<li >
    <a href="../../benchmarks/bloomfilter/">Bloom Filter</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">YCSB Tuning Contest <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../">Tuning Contest Overview</a>
</li>

                        
                            
<li >
    <a href="../Tuning_team_SSTable_report/">(Rank 1) Team SSTable</a>
</li>

                        
                            
<li >
    <a href="../Tuning_team_bloomfilter_report/">(Rank 1) Team Bloom Filter</a>
</li>

                        
                            
<li >
    <a href="../Tuning_team_WAL%2CManifest_report/">(Rank 3) Team WAL/Manifest</a>
</li>

                        
                            
<li >
    <a href="../Tuning_team_memtable_report/">(Rank 4) Team Memtable</a>
</li>

                        
                            
<li >
    <a href="../Tuning_team_cache_report/">(Rank 5) Team Cache</a>
</li>

                        
                            
<li class="active">
    <a href="./">(Rank 6) Team Compaction</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Assignments <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../practice/practice/">Assignments</a>
</li>

                        
                            
<li >
    <a href="../../practice/answer/">Answers</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fas fa-search"></i> Search
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../Tuning_team_cache_report/">
                            <i class="fas fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="next" href="../../practice/practice/">
                            Next <i class="fas fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#team-compaction-ycsb-tuning-report">[Team Compaction] YCSB Tuning Report</a></li>
            <li class="second-level"><a href="#db-options-for-tunning">DB options for tunning</a></li>
                
            <li class="second-level"><a href="#analyze-workloads">Analyze workloads</a></li>
                
            <li class="second-level"><a href="#hypothesis-and-experiment">Hypothesis and experiment</a></li>
                
                <li class="third-level"><a href="#hypothesis">Hypothesis</a></li>
                <li class="third-level"><a href="#default">Default</a></li>
                <li class="third-level"><a href="#write_buffer_size-8mb">write_buffer_size 8MB</a></li>
                <li class="third-level"><a href="#write_buffer_size-32mb-max_file_size-8mb">write_buffer_size 32MB, max_file_size 8MB</a></li>
                <li class="third-level"><a href="#cacahe_size-8mb-block_size-2kb">cacahe_size 8MB, block_size 2KB</a></li>
            <li class="second-level"><a href="#therefore-the-best-options">Therefore, the best options</a></li>
                
            <li class="second-level"><a href="#conclusion-and-discussion">Conclusion and discussion</a></li>
                
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h2 id="team-compaction-ycsb-tuning-report">[Team Compaction] YCSB Tuning Report</h2>
<h3 id="db-options-for-tunning">DB options for tunning</h3>
<hr />
<table>
<thead>
<tr>
<th>options</th>
<th>default</th>
<th>Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td>leveldb.write_buffer_size</td>
<td>2MB</td>
<td>single memtable size</td>
</tr>
<tr>
<td>leveldb.max_file_size</td>
<td>4MB</td>
<td>sstable size</td>
</tr>
<tr>
<td>leveldb.compression</td>
<td>snappy</td>
<td>compression method</td>
</tr>
<tr>
<td>leveldb.cache_size</td>
<td>4M</td>
<td>cache size</td>
</tr>
<tr>
<td>leveldb.filter_bits</td>
<td>10</td>
<td>number of filter block bits</td>
</tr>
<tr>
<td>leveldb.block_size</td>
<td>4KB</td>
<td>size of data block in one file</td>
</tr>
<tr>
<td>leveldb.block_restart_interval</td>
<td>16</td>
<td>number of keys between restart points(delta encoding)</td>
</tr>
</tbody>
</table>
<h3 id="analyze-workloads">Analyze workloads</h3>
<hr />
<p><img alt="img" src="https://user-images.githubusercontent.com/87025898/183247993-0133d8c1-3b40-455e-987d-f54892488e84.png" /><br />
A: Read/update ratio: 50/50<br />
B: Read/update ratio: 95/5<br />
D: Read/update/insert ratio: 95/0/5  <br />
Because of the high read proportion, consideration is given to ways to maximize read performance.<br />
Of course, consider write performance and choose the best option.  </p>
<h3 id="hypothesis-and-experiment">Hypothesis and experiment</h3>
<hr />
<p>Considering that it is run at random, it is measured with an average of 3 times.  </p>
<h4 id="hypothesis">Hypothesis</h4>
<p>Based on what was studied in the study, it is expected that writing performance will increase as the size of the buffer increases the amount of writing at once.<br />
In addition, it is expected that read performance will improve if the size of the file is 1/4 of the size of the buffer, allowing four files, which are the thresholds of level0, to be read at once, and increasing the cache size.<br />
Finally, by reducing the size of the block, increasing the number of bits in the index of the file, and increasing the number of bits in the filter block, the read performance is expected to be improved  </p>
<h4 id="default">Default</h4>
<table>
<thead>
<tr>
<th>workload</th>
<th>runtime(sec)</th>
<th>throughput(ops/sec)</th>
</tr>
</thead>
<tbody>
<tr>
<td>load</td>
<td>6.22135</td>
<td>16073.7</td>
</tr>
<tr>
<td>A</td>
<td>2.88199</td>
<td>34698.2</td>
</tr>
<tr>
<td>B</td>
<td>0.753103</td>
<td>132784</td>
</tr>
<tr>
<td>D</td>
<td>0.545697</td>
<td>183252</td>
</tr>
</tbody>
</table>
<h4 id="write_buffer_size-8mb">write_buffer_size 8MB</h4>
<table>
<thead>
<tr>
<th>workload</th>
<th>runtime(sec)</th>
<th>throughput(ops/sec)</th>
<th>-&gt;</th>
<th>runtime(sec)</th>
<th>throughput(ops/sec)</th>
</tr>
</thead>
<tbody>
<tr>
<td>load</td>
<td>6.22135</td>
<td>16073.7</td>
<td>-&gt;</td>
<td>4.58351</td>
<td>21817.4</td>
</tr>
<tr>
<td>A</td>
<td>2.88199</td>
<td>34698.2</td>
<td>-&gt;</td>
<td>2.30625</td>
<td>43360.4</td>
</tr>
<tr>
<td>B</td>
<td>0.753103</td>
<td>132784</td>
<td>-&gt;</td>
<td>0.738974</td>
<td>135323</td>
</tr>
<tr>
<td>D</td>
<td>0.545697</td>
<td>183252</td>
<td>-&gt;</td>
<td>0.50175</td>
<td>199302</td>
</tr>
</tbody>
</table>
<p>As the write performance improved, the performance of load and A improved.  </p>
<h4 id="write_buffer_size-32mb-max_file_size-8mb">write_buffer_size 32MB, max_file_size 8MB</h4>
<table>
<thead>
<tr>
<th>workload</th>
<th>runtime(sec)</th>
<th>throughput(ops/sec)</th>
<th>-&gt;</th>
<th>runtime(sec)</th>
<th>throughput(ops/sec)</th>
</tr>
</thead>
<tbody>
<tr>
<td>load</td>
<td>6.22135</td>
<td>16073.7</td>
<td>-&gt;</td>
<td>1.33948</td>
<td>74655.9</td>
</tr>
<tr>
<td>A</td>
<td>2.88199</td>
<td>34698.2</td>
<td>-&gt;</td>
<td>1.44349</td>
<td>69276.5</td>
</tr>
<tr>
<td>B</td>
<td>0.753103</td>
<td>132784</td>
<td>-&gt;</td>
<td>0.708532</td>
<td>141137</td>
</tr>
<tr>
<td>D</td>
<td>0.545697</td>
<td>183252</td>
<td>-&gt;</td>
<td>0.502773</td>
<td>198897</td>
</tr>
</tbody>
</table>
<p>The buffer size was further increased to 32MB(no performance changes after increasing more than 32MB), and the file size was 8MB, so that only Level 0 could be filled first, and it could be seen that the write performance was improved.    </p>
<h4 id="cacahe_size-8mb-block_size-2kb">cacahe_size 8MB, block_size 2KB</h4>
<table>
<thead>
<tr>
<th>workload</th>
<th>runtime(sec)</th>
<th>throughput(ops/sec)</th>
<th>-&gt;</th>
<th>runtime(sec)</th>
<th>throughput(ops/sec)</th>
</tr>
</thead>
<tbody>
<tr>
<td>load</td>
<td>6.22135</td>
<td>16073.7</td>
<td>-&gt;</td>
<td>1.33054</td>
<td>75157.5</td>
</tr>
<tr>
<td>A</td>
<td>2.88199</td>
<td>34698.2</td>
<td>-&gt;</td>
<td>1.38317</td>
<td>72297.5</td>
</tr>
<tr>
<td>B</td>
<td>0.753103</td>
<td>132784</td>
<td>-&gt;</td>
<td>0.690946</td>
<td>144729</td>
</tr>
<tr>
<td>D</td>
<td>0.545697</td>
<td>183252</td>
<td>-&gt;</td>
<td>0.484127</td>
<td>206557</td>
</tr>
</tbody>
</table>
<p>For read performance, the cache size was increased and the block size was reduced. (More cache than 8MB or less block size makes little difference in performance)<br />
It was found that the performance of workload B and C, which had a high reading proportion, improved slightly.  <br />
Here, increasing the filter block and changing block_restart_interval does not cause any worse performance or make any difference.  </p>
<h3 id="therefore-the-best-options">Therefore, the best options</h3>
<table>
<thead>
<tr>
<th>the best options</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>leveldb.write_buffer_size</td>
<td>32MB</td>
</tr>
<tr>
<td>leveldb.max_file_size</td>
<td>8MB</td>
</tr>
<tr>
<td>leveldb.compression</td>
<td>snappy</td>
</tr>
<tr>
<td>leveldb.cache_size</td>
<td>8MB</td>
</tr>
<tr>
<td>leveldb.filter_bits</td>
<td>10</td>
</tr>
<tr>
<td>leveldb.block_size</td>
<td>2KB</td>
</tr>
<tr>
<td>leveldb.block_restart_interval</td>
<td>16</td>
</tr>
</tbody>
</table>
<h3 id="conclusion-and-discussion">Conclusion and discussion</h3>
<hr />
<p>We selected the best option by properly increasing the buffer size, file size, and cache size to 32MB, 8MB, and 8MB, respectively, and the block size to half 2KB.<br />
It was clear that writing performance improved. However, it was predicted that read performance would improve if the cache size was increased to increase the hit rate and the block size was reduced to increase the items included in the index, but read performance did not improve significantly. There may be several factors for this reason, but the unpredictable factor is believed to be the main cause because data is accessed randomly.  </p>
<p>Using one-third of the memory as a cache is good in terms of tradeoff, which can leave a large amount of OS page cache, so it is expensive to avoid memory budgeting, but in terms of performance, it is expected that the performance will be better if the size is increased by utilizing the remaining cache well.</p></div>
        
        
    </div>

    
      <footer class="col-md-12 text-center">
          
          
            <hr>
            <p>
            <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</small>
            </p>
          

          
          
      </footer>
    
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../../js/bootstrap-3.0.3.min.js"></script>

    
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/highlight.min.js"></script>
        
    <script>hljs.initHighlightingOnLoad();</script>
    

    <script>var base_url = "../.."</script>
    
    <script src="../../js/base.js"></script>
    <script src="../../search/main.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    </body>

</html>
