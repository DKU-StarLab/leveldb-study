<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../../img/favicon.ico">

    
    <title>Bloom Filter - LevelDB WIKI</title>
    

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/v4-shims.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.min.css">
    <link href='//rsms.me/inter/inter.css' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../../css/base.min.css" rel="stylesheet">
    <link href="../../css/cinder.min.css" rel="stylesheet">

    
        
        <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/styles/github.min.css">
        
    

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

    

     
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            
              <a class="navbar-brand" href="../..">LevelDB WIKI</a>
            
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Code Analysis <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../analysis/memtable/">Memtable</a>
</li>

                        
                            
<li >
    <a href="../../analysis/wal/">WAL</a>
</li>

                        
                            
<li >
    <a href="../../analysis/manifest/">Manifest</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Compaction</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../analysis/compaction/compaction/">Compaction Types</a>
</li>

        
            
<li >
    <a href="../../analysis/compaction/Major-Compaction/">Major Compaction</a>
</li>

        
            
<li >
    <a href="../../analysis/compaction/Minor-Compaction/">Minor Compaction</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">SSTable</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../analysis/sstable/sstable/">SSTable Structure</a>
</li>

        
            
<li >
    <a href="../../analysis/sstable/sstable-write/">SSTable Write</a>
</li>

        
            
<li >
    <a href="../../analysis/sstable/sstable-read/">SSTable Read</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Bloom Filter</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../../analysis/bloomfilter/bloomfilter/">Bloom Filter Structure</a>
</li>

        
            
<li >
    <a href="../../analysis/bloomfilter/bloomfilter-write/">Bloom Filter Write</a>
</li>

        
            
<li >
    <a href="../../analysis/bloomfilter/bloomfilter-read/">Bloom Filter Read</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../../analysis/cache/">Cache</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Benchmark Experiment <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">WAL</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../wal_1/">Disable_wal</a>
</li>

        
            
<li >
    <a href="../wal_2/">Max_total_wal_size</a>
</li>

        
            
<li >
    <a href="../wal_3/">Manual_wal_flush</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../compaction/">Compaction</a>
</li>

                        
                            
<li >
    <a href="../sstable/">SSTable</a>
</li>

                        
                            
<li class="active">
    <a href="./">Bloom Filter</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">YCSB Tuning Contest <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../tuning/">Tuning Contest Overview</a>
</li>

                        
                            
<li >
    <a href="../../tuning/Tuning_team_SSTable_report/">(Rank 1) Team SSTable</a>
</li>

                        
                            
<li >
    <a href="../../tuning/Tuning_team_bloomfilter_report/">(Rank 1) Team Bloom Filter</a>
</li>

                        
                            
<li >
    <a href="../../tuning/Tuning_team_WAL%2CManifest_report/">(Rank 3) Team WAL/Manifest</a>
</li>

                        
                            
<li >
    <a href="../../tuning/Tuning_team_memtable_report/">(Rank 4) Team Memtable</a>
</li>

                        
                            
<li >
    <a href="../../tuning/Tuning_team_cache_report/">(Rank 5) Team Cache</a>
</li>

                        
                            
<li >
    <a href="../../tuning/Tuning_team_Compaction_report/">(Rank 6) Team Compaction</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Assignments <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../practice/practice/">Assignments</a>
</li>

                        
                            
<li >
    <a href="../../practice/answer/">Answers</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fas fa-search"></i> Search
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../sstable/">
                            <i class="fas fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="next" href="../../tuning/">
                            Next <i class="fas fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#bloom-filter">Bloom Filter</a></li>
            <li class="second-level"><a href="#hypothesis-1">Hypothesis 1</a></li>
                
                <li class="third-level"><a href="#fillrandom-performance-measurement">Fillrandom Performance Measurement</a></li>
                <li class="third-level"><a href="#readrandom-performance-measurement">Readrandom Performance Measurement</a></li>
            <li class="second-level"><a href="#hypothesis-2">Hypothesis 2</a></li>
                
                <li class="third-level"><a href="#result">Result</a></li>
            <li class="second-level"><a href="#hypothesis-3">Hypothesis 3</a></li>
                
                <li class="third-level"><a href="#result_1">Result</a></li>
            <li class="second-level"><a href="#hypothesis-4">Hypothesis 4</a></li>
                
                <li class="third-level"><a href="#result_2">Result</a></li>
            <li class="second-level"><a href="#hypothesis-5">Hypothesis 5</a></li>
                
                <li class="third-level"><a href="#result_3">Result</a></li>
            <li class="second-level"><a href="#hypothesis-6">Hypothesis 6</a></li>
                
                <li class="third-level"><a href="#result_4">Result</a></li>
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h2 id="bloom-filter">Bloom Filter</h2>
<p><img alt="img1 daumcdn" src="https://user-images.githubusercontent.com/101636590/183424363-05494e10-e230-45b1-9a2a-18f413748970.png" />
(Source: https://en.wikipedia.org/wiki/Bloom_filter)</p>
<p>A Bloom filter is a probabilistic data structure that quickly checks for the presence of a specific key in a data block.</p>
<p>In <code>db_bench</code>, you can adjust the value of <code>bloom_bits</code> to create a Bloom filter of your desired size. This experiment aims to explore the performance differences based on the value of <code>bloom_bits</code> and the reasons behind them.</p>
<h3 id="hypothesis-1">Hypothesis 1</h3>
<p>As the size of the Bloom filter increases, false positives decrease, improving performance. However, the overhead required to read and write the Bloom filter also increases, creating a trade-off. Considering this trade-off, the optimal <code>bloom_bits</code> value would be the default value used by LevelDB, which is 10 bits.</p>
<h4 id="fillrandom-performance-measurement">Fillrandom Performance Measurement</h4>
<table>
<thead>
<tr>
<th>Bits per key</th>
<th>Throughput</th>
<th>Latency</th>
</tr>
</thead>
<tbody>
<tr>
<td>-1</td>
<td>28.21</td>
<td>4.327</td>
</tr>
<tr>
<td>0</td>
<td>28.13</td>
<td>4.389</td>
</tr>
<tr>
<td>1</td>
<td>28.01</td>
<td>4.472</td>
</tr>
<tr>
<td>5</td>
<td>27.92</td>
<td>4.475</td>
</tr>
<tr>
<td>10</td>
<td>27.56</td>
<td>4.486</td>
</tr>
<tr>
<td>30</td>
<td>26.72</td>
<td>4.729</td>
</tr>
<tr>
<td>50</td>
<td>25.49</td>
<td>5.292</td>
</tr>
<tr>
<td>100</td>
<td>25.46</td>
<td>5.382</td>
</tr>
<tr>
<td>1000</td>
<td>19.11</td>
<td>7.781</td>
</tr>
</tbody>
</table>
<p><img alt="image" src="https://user-images.githubusercontent.com/101636590/188536205-ebae47e8-9f0e-46be-8c13-d98c026a67e2.png" /></p>
<p><img alt="image" src="https://user-images.githubusercontent.com/101636590/188535916-10cb4bd4-d76c-42d5-90bf-62369d71cbb3.png" /></p>
<p>As the number of bits per key increases, latency increases and throughput decreases.</p>
<h4 id="readrandom-performance-measurement">Readrandom Performance Measurement</h4>
<table>
<thead>
<tr>
<th>Bits per key</th>
<th>Latency</th>
</tr>
</thead>
<tbody>
<tr>
<td>-1</td>
<td>3.20</td>
</tr>
<tr>
<td>0</td>
<td>2.84</td>
</tr>
<tr>
<td>1</td>
<td>2.81</td>
</tr>
<tr>
<td>5</td>
<td>2.78</td>
</tr>
<tr>
<td>10</td>
<td>2.41</td>
</tr>
<tr>
<td>30</td>
<td>2.97</td>
</tr>
<tr>
<td>50</td>
<td>3.40</td>
</tr>
<tr>
<td>100</td>
<td>3.56</td>
</tr>
<tr>
<td>1000</td>
<td>5.69</td>
</tr>
</tbody>
</table>
<p><img alt="image" src="https://user-images.githubusercontent.com/101636590/188536768-d836e937-2788-44c4-b292-e89d8c09f535.png" /></p>
<p>As the number of bits per key increases, latency initially decreases but then increases again. This suggests that initially, the performance improvement from the Bloom filter outweighs the overhead, but eventually, the overhead becomes too large, reducing throughput.</p>
<p><img alt="image" src="https://user-images.githubusercontent.com/101636590/183422850-3879d47a-209e-4c00-9462-96f1cd8cd5b1.png" /></p>
<p>Additionally, the number 10 is identified as the threshold that enhances read performance without significantly degrading write performance, which is why LevelDB uses 10 bits per key as the default value.</p>
<h3 id="hypothesis-2">Hypothesis 2</h3>
<p>The size of the Bloom filter is determined by the number of bits per key and the number of data items. If these values are fixed and only the data size is changed, the overhead from the Bloom filter should remain unchanged.</p>
<h4 id="result">Result</h4>
<p><img alt="image" src="https://user-images.githubusercontent.com/101636590/188540907-795ac9bf-348f-463a-a79d-c82a4fcb68dd.png" /></p>
<p><img alt="image" src="https://user-images.githubusercontent.com/101636590/188540987-7aa69da2-f7ec-4e7e-81cb-93f7f23eeda3.png" /></p>
<p>When the <code>value_size</code> is 128 Bytes, using a Bloom filter results in a 7% decrease in write performance and a 7% increase in read performance. When the <code>value_size</code> is increased tenfold to 1280 Bytes, the write performance decreases by 8% and the read performance increases by 9.5%.</p>
<p>Contrary to the hypothesis, it appears that <code>value_size</code> also affects the performance difference caused by the Bloom filter. This is likely because, although the overall size of the Bloom filter remains the same, each Bloom filter is divided into smaller parts, requiring additional overhead for reading and writing.</p>
<h3 id="hypothesis-3">Hypothesis 3</h3>
<p>When the number of bits per key in a Bloom filter is fixed, the mathematically proven optimal number of hashes is ln2 * bloom_bits ≈ 0.69 * bloom_bits. However, since the number of hashes cannot be a fraction, if we use the default value of 10 bits in LevelDB, the number of hashes becomes 6 instead of 6.9. Therefore, using 7 hash functions, which is closer to the theoretically optimal value, should improve performance.</p>
<h4 id="result_1">Result</h4>
<p><img alt="image" src="https://user-images.githubusercontent.com/101636590/188542665-f40355bf-2e3e-4926-913f-8deaabadcf42.png" /></p>
<p>The results were almost identical, but using 7 hash functions slightly decreased write performance and slightly improved read performance, though the difference was minimal.</p>
<p><img alt="image" src="https://user-images.githubusercontent.com/101636590/188542986-bc017ba8-4e05-4f2e-8e06-7f5757fe77f1.png" /></p>
<p>Mathematically, the difference in the probability of false positives between using 6 and 7 hash functions is 0.00024, which is negligible and likely equivalent to the additional overhead from processing one more hash during reading.</p>
<h3 id="hypothesis-4">Hypothesis 4</h3>
<p>If we use 9 bits (6.21 &lt;-&gt; 6) or 12 bits (8.28 &lt;-&gt; 8), which are closer to the theoretically optimal number of hash functions, performance should improve.</p>
<h4 id="result_2">Result</h4>
<p><img alt="image" src="https://user-images.githubusercontent.com/101636590/188543384-32643815-612a-4f40-b5b1-4bd67103aacc.png" /></p>
<p>Contrary to expectations, the best results were obtained when using 10 bits.</p>
<p><img alt="image" src="https://user-images.githubusercontent.com/101636590/188543466-a3e12c1c-77f9-42ce-a674-dc3214db5c11.png" /></p>
<p>Using 12 bits and 8 hashes significantly reduced the probability of false positives compared to the default 10 bits and 6 hashes, but considering the overhead required to process 2 additional bits and 2 hashes, the difference in read performance was not significant, and write performance decreased.</p>
<p><img alt="image" src="https://user-images.githubusercontent.com/101636590/188544697-3e50231b-4709-41c5-a111-2c119a036bdf.png" /></p>
<p>When using 6 hashes and 9 bits, the write performance was similar to the default case, but read performance decreased.</p>
<p><img alt="image" src="https://user-images.githubusercontent.com/101636590/188544749-24cfabb8-f4ee-48ae-a9aa-379ee1b963d3.png" /></p>
<p>This is because, contrary to my expectations, the optimal number of hashes is the value that minimizes false positives when the bloom_bits value is fixed. Conversely, if the number of hashes is fixed, false positives decrease as the bloom_bits value increases.</p>
<h3 id="hypothesis-5">Hypothesis 5</h3>
<p><img alt="image" src="https://user-images.githubusercontent.com/101636590/188545415-3b94a1a0-2577-4a61-83a1-66e939c6d8de.png" /></p>
<p>From the experimental results above, it was found that with the same number of hashes, a larger bloom_bits value results in better read performance. Considering that the bloom_bits value has a greater impact on false positives than the number of hashes, and that the overhead of the Bloom filter is largely due to the number of hashes, it is hypothesized that fixing the number of hashes and increasing the bloom_bits value will yield better performance results.</p>
<h4 id="result_3">Result</h4>
<p><img alt="image" src="https://user-images.githubusercontent.com/101636590/188545779-24ac7ed8-dba5-41b7-b17a-33799ad49b42.png" /></p>
<p>Using 6 hash functions with 10 bits and 30 bits each resulted in a slight increase in read performance but a decrease in write performance. Despite adjusting various variables and conducting numerous measurements, it seems difficult to achieve better results than using the default 10 bits with 6 hash functions through simple numerical adjustments.</p>
<h3 id="hypothesis-6">Hypothesis 6</h3>
<p>False positives can only occur if the data to be read does not exist. Therefore, in the ReadMissing benchmark, where only non-existent keys are searched, the impact of false positives will be greater than in ReadRandom.</p>
<h4 id="result_4">Result</h4>
<p><img alt="image" src="https://user-images.githubusercontent.com/101636590/188546151-a06edf9a-93a0-4ed3-b277-f24f39251422.png" /></p>
<p>Unlike FillRandom, which consistently decreases in performance, and ReadRandom, which increases and then decreases around 10 bits, ReadMissing shows a significant performance increase as soon as a Bloom filter is used, and performance continues to improve as the number of bits increases. This is likely because, as hypothesized, in ReadMissing, the performance improvement from reducing false positives outweighs the overhead from increasing the Bloom filter size.</p></div>
        
        
    </div>

    
      <footer class="col-md-12 text-center">
          
          
            <hr>
            <p>
            <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</small>
            </p>
          

          
          
      </footer>
    
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../../js/bootstrap-3.0.3.min.js"></script>

    
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/highlight.min.js"></script>
        
    <script>hljs.initHighlightingOnLoad();</script>
    

    <script>var base_url = "../.."</script>
    
    <script src="../../js/base.js"></script>
    <script src="../../search/main.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    </body>

</html>
